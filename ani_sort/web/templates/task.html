<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AniSort Tasks</title>
    <style>
        body { font-family: sans-serif; margin: 2rem; background: #f9f9f9; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: #fff; }
        th, td { border: 1px solid #ccc; padding: 0.5rem 0.8rem; text-align: left; }
        th { background: #eee; }
        tr:nth-child(even) { background: #f5f5f5; }
        h1 { margin-bottom: 0.5rem; }
        form { margin-bottom: 1rem; }
        input { padding: 0.4rem; margin-right: 0.5rem; }
        button { padding: 0.4rem 1rem; cursor: pointer; }
        .status-running { color: orange; font-weight: bold; }
        .status-success { color: green; font-weight: bold; }
        .status-failed { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>AniSort Tasks Lists</h1>

    <!-- <form action="/tasks/run" method="post"> -->
    <!--     <input type="text" name="input_path" placeholder="Input folder" required> -->
    <!--     <input type="text" name="output_path" placeholder="Output folder (optional)"> -->
    <!--     <button type="submit">Run Sort</button> -->
    <!-- </form> -->

    <hr>

    {% for task in pending %}
      <div class="task-card">
        <h3>{{ task.input_path }}</h3>
        <form action="/tasks/{{ task.id }}/run" method="post">
          <button type="submit">Sort Now</button>
        </form>
      </div>
    {% else %}
      <p>No pending folders detected.</p>
    {% endfor %}


    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Anime ID</th>
                <th>Input Path</th>
                <th>Output Path</th>
                <th>Status</th>
                <th>Start</th>
                <th>End</th>
                <th>Error</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.id }}</td>
                <td>{{ task.anime_id or '-' }}</td>
                <td>{{ task.input_path }}</td>
                <td>{{ task.output_path or '-' }}</td>
                <td class="status-{{ task.status|lower }}">{{ task.status }}</td>
                <td>{{ task.started_at.strftime('%Y-%m-%d %H:%M:%S') if task.started_at else '-' }}</td>
                <td>{{ task.ended_at.strftime('%Y-%m-%d %H:%M:%S') if task.ended_at else '-' }}</td>
                <td>{{ task.error_msg or '-' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="8" style="text-align:center; color:#888;">No tasks yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
